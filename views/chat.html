<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>واتساب أنس - قائمة الأصدقاء</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        header { background: #075E54; color: white; padding: 15px; text-align: center; border-radius: 10px; margin-bottom: 20px; }
        .add-btn { display: block; background: #25D366; color: white; text-align: center; padding: 15px; border-radius: 10px; text-decoration: none; font-weight: bold; margin-bottom: 20px; }
        .friend-card { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .friend-info { cursor: pointer; flex: 1; }
        .remove-btn { color: red; border: none; background: none; padding: 10px; cursor: pointer; font-size: 18px; }
    </style>
</head>
<body>
    <header><h3>مرحباً بك (ID: <span id="my-id"></span>)</h3></header>
    
    <a href="#" id="add-link" class="add-btn">➕ إضافة صديق جديد</a>

    <div id="friends-list"></div>

    <script>
        const userId = window.location.pathname.split('/').pop();
        document.getElementById('my-id').innerText = userId;
        document.getElementById('add-link').href = `/add-friend-page/${userId}`;

        async function loadFriends() {
            const res = await fetch('/api/friends/' + userId);
            const friends = await res.json();
            document.getElementById('friends-list').innerHTML = friends.map(f => `
                <div class="friend-card">
                    <div class="friend-info" onclick="location.href='/chat-view/${userId}/${f.id}'">
                        <strong>${f.name}</strong> <br>
                        <small style="color:gray">ID: ${f.id}</small>
                    </div>
                    <button class="remove-btn" onclick="removeFriend('${f.id}')">×</button>
                </div>
            `).join('');
        }

        async function removeFriend(fId) {
            if(confirm('حذف الصديق؟')) {
                await fetch('/api/remove-friend', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({userId, friendId:fId})});
                loadFriends();
            }
        }
        loadFriends();
    </script>
</body>
</html>